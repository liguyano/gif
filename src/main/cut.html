<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image Upload, Edit, and Download with Canvas</title>
<style>
  canvas { border: 1px solid black; }
</style>
</head>
<body>
<h1>Image Upload, Edit, and Download with Canvas</h1>
<input type="file" id="imageUpload" accept="image/*">
<button id="downloadButton">Download Image</button>
<canvas id="myCanvas" width="300" height="300"></canvas>

<script>
  // 获取页面元素
  const canvas = document.getElementById('myCanvas');
  const ctx = canvas.getContext('2d');
  const input = document.getElementById('imageUpload');
  const downloadButton = document.getElementById('downloadButton');

  // 添加事件监听器，当用户选择文件时触发
  input.addEventListener('change', handleFileSelect, false);

  // 添加事件监听器，当用户点击下载按钮时触发
  downloadButton.addEventListener('click', downloadImage, false);

  function handleFileSelect(event) {
    // 获取选中的文件
    const file = event.target.files[0];
    if (!file) return;

    // 创建一个 FileReader 对象来读取文件
    const reader = new FileReader();

    // 当文件读取完成后，将图片绘制到 Canvas
    reader.onload = function(e) {
      const img = new Image();
      img.onload = function() {
        // 清除画布
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        // 绘制图片
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      };
      img.src = e.target.result;
    };

    // 读取文件内容
    reader.readAsDataURL(file);
  }

  function downloadImage() {
    // 使用 toDataURL 方法将 Canvas 内容转换为 Data URL
    const imageDataUrl = canvas.toDataURL('image/png');

    // 创建一个隐藏的 <a> 标签用于下载
    const link = document.createElement('a');
    link.href = imageDataUrl;
    link.download = 'edited-image.png'; // 设置下载文件名
    link.style.display = 'none';

    // 将 <a> 标签添加到文档中并模拟点击
    document.body.appendChild(link);
    link.click();

    // 清理 <a> 标签
    document.body.removeChild(link);
  }
</script>
</body>
</html>